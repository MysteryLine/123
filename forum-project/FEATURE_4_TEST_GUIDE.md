# 功能 4 测试指南 🧪

## 测试环境准备

### 前提条件
- ✅ 已启动前端（`npm run dev` on port 3000）
- ✅ 已启动后端（`npm run dev` on port 5000）
- ✅ 已登录用户账户
- ✅ 存在发布的帖子和评论

## 测试场景

### 1️⃣ 帖子点赞互动测试

**位置**：帖子详情页 (`/posts/[帖子ID]`)

#### 场景 1.1：首次点赞
```
步骤：
1. 进入任何帖子的详情页
2. 在帖子内容下方找到互动按钮
3. 点击 "👍" 按钮

预期结果：
✓ 按钮背景变为浅绿色
✓ 按钮文字变为绿色且加粗
✓ 按钮边框变为绿色（2px）
✓ 按钮上方出现浮动文字（如 "太棒了！👍"）
✓ 浮动文字向上飘起 2 秒后消失
✓ 点赞数 +1
✓ 👎 踩按钮保持原状（如果之前踩过则变回原状）
```

#### 场景 1.2：取消点赞
```
步骤：
1. 在已点赞的帖子上再次点击 "👍"

预期结果：
✓ 按钮背景恢复为白色
✓ 按钮文字恢复为灰色
✓ 按钮边框恢复为浅灰色
✓ 点赞数 -1
✓ 没有浮动文字出现
```

#### 场景 1.3：踩帖子
```
步骤：
1. 点击 "👎" 按钮

预期结果：
✓ 👎 按钮背景变为浅红色
✓ 👎 按钮文字变为红色且加粗
✓ 👎 按钮边框变为红色（2px）
✓ 按钮上方出现浮动搞笑文字（如 "别踩啦，作者会哭的😭"）
✓ 浮动文字向上飘起 2 秒后消失
✓ 踩数 +1
✓ 如果之前点赞过，👍 按钮自动取消（点赞数 -1）
```

#### 场景 1.4：切换点赞和踩
```
步骤：
1. 点赞状态下，点击 "👎" 按钮

预期结果：
✓ 👍 按钮自动恢复原状（点赞数 -1）
✓ 👎 按钮变为活跃状态（踩数 +1）
✓ 踩提示词浮动显示

步骤：
2. 踩状态下，点击 "👍" 按钮

预期结果：
✓ 👎 按钮自动恢复原状（踩数 -1）
✓ 👍 按钮变为活跃状态（点赞数 +1）
✓ 点赞提示词浮动显示
```

---

### 2️⃣ 评论互动测试

**位置**：帖子详情页评论区 (`/posts/[帖子ID]#comments`)

#### 场景 2.1：评论点赞
```
步骤：
1. 在评论区找到任何评论
2. 在评论下方点击 "👍" 按钮

预期结果：
✓ 按钮尺寸比帖子互动按钮小（small size）
✓ 所有视觉效果与帖子互动相同
✓ 浮动文字显示（点赞提示词）
✓ 评论点赞数 +1
```

#### 场景 2.2：评论踩
```
步骤：
1. 点击评论的 "👎" 按钮

预期结果：
✓ 按钮尺寸为 small
✓ 所有视觉效果与帖子互动相同
✓ 浮动文字显示（踩提示词，红色）
✓ 评论踩数 +1
✓ 如果点赞过则自动取消
```

---

### 3️⃣ 动效测试

#### 场景 3.1：浮动文字动效
```
步骤：
1. 连续快速点击 "👍" 多次

预期结果：
✓ 多个提示词同时向上飘出
✓ 每个提示词独立地渐隐消失
✓ 2 秒后所有文字完全消失
✓ 没有遗留的 DOM 元素
```

#### 场景 3.2：提示词随机性
```
步骤：
1. 在不同的评论上重复点赞/踩

预期结果：
✓ 每次出现的提示词都可能不同
✓ 至少显示了 6+ 个不同的点赞提示词
✓ 至少显示了 8+ 个不同的踩提示词
```

---

### 4️⃣ 状态持久化测试

#### 场景 4.1：刷新页面后状态保持
```
步骤：
1. 点赞或踩某个帖子/评论
2. 按 F5 刷新页面
3. 再次进入该帖子详情页

预期结果：
✓ 之前点赞/踩的状态保持不变
✓ 按钮依然处于活跃状态
✓ 数字正确
```

#### 场景 4.2：后端数据同步
```
步骤：
1. 在帖子详情页点赞
2. 返回帖子列表页
3. 再次进入同一帖子

预期结果：
✓ 点赞状态与之前一致
✓ 点赞数显示正确
```

---

### 5️⃣ 未登录状态测试

#### 场景 5.1：未登录点赞
```
步骤：
1. 退出登录（清除 token）
2. 进入帖子详情页
3. 点击 "👍" 或 "👎" 按钮

预期结果：
✓ 显示提示："请先登录"
✓ 后端返回 401 错误
✓ 不显示浮动文字
✓ 数字不更改
```

---

### 6️⃣ 边界条件测试

#### 场景 6.1：数字不为负
```
步骤：
1. 在踩数为 0 的状态下，多次尝试取消踩

预期结果：
✓ 踩数始终 ≥ 0
✓ 不出现负数
```

#### 场景 6.2：快速连击
```
步骤：
1. 快速连续点击 "👍" 3-4 次
2. 然后点击 "👎"
3. 再快速点击 "👍"

预期结果：
✓ UI 状态同步
✓ 数字正确
✓ 没有闪现或抖动
✓ 所有动画流畅
```

---

### 7️⃣ 响应式设计测试

#### 场景 7.1：不同尺寸设备
```
步骤：
1. 在不同屏幕宽度下测试（桌面、平板、手机）
2. 验证按钮和文字显示

预期结果：
✓ 帖子互动按钮（medium）在各尺寸下适配
✓ 评论互动按钮（small）在各尺寸下适配
✓ 浮动文字不超出屏幕
✓ 触点足够大（移动设备）
```

---

## 提示词验证清单

### 点赞提示词
- [ ] "太棒了！👍" - 出现过
- [ ] "我喜欢！❤️" - 出现过
- [ ] "你真幽默！😂" - 出现过
- [ ] "深表赞同！💯" - 出现过
- [ ] "绝妙的想法！✨" - 出现过
- [ ] "让我点个赞！🌟" - 出现过

### 踩提示词
- [ ] "别踩啦，作者会哭的😭" - 出现过
- [ ] "手下留情～🥺" - 出现过
- [ ] "都是误会呀～" - 出现过
- [ ] "给我一次改过的机会吧！😢" - 出现过
- [ ] "我会改进的，相信我！💪" - 出现过
- [ ] "请不要伤害我QAQ" - 出现过
- [ ] "其实我很努力的…" - 出现过
- [ ] "有什么问题请指正👉" - 出现过

---

## 常见问题排查

### 问题：浮动文字不显示
**可能原因**：
- 容器 `ref` 未正确获取
- 提示词添加函数未被调用

**解决方案**：
```
检查浏览器控制台是否有报错
查看 React DevTools 中 floatingMessages 是否更新
```

### 问题：按钮样式不更新
**可能原因**：
- 状态未正确更新
- CSS 优先级问题

**解决方案**：
```
在控制台检查 isUserLiked 和 isUserDisliked 状态
检查是否有其他 CSS 覆盖
```

### 问题：数字不同步
**可能原因**：
- 后端 API 返回错误
- 前端没有正确处理响应

**解决方案**：
```
检查网络请求是否成功（F12 Network 标签）
查看后端错误日志
```

---

## 性能测试

### 内存泄漏检查
```javascript
// 在控制台运行
performance.memory
// 查看 usedJSHeapSize 是否稳定
```

### 动画帧率检查
```
打开 Chrome DevTools → Performance
录制点赞/踩操作
检查帧率是否稳定在 60fps
```

---

## 测试完成清单

- [ ] 所有场景测试通过
- [ ] 提示词验证完成
- [ ] 响应式设计验证
- [ ] 未登录状态测试
- [ ] 边界条件测试
- [ ] 性能测试通过
- [ ] 无浏览器控制台错误
- [ ] 后端日志正常

---

**更新时间**：2025-12-05
**测试状态**：待测试 ⏳
