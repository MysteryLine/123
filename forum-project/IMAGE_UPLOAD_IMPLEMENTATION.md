# å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½å®ç°æ€»ç»“

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. åç«¯å®ç°
- âœ… å®‰è£…å¹¶é…ç½®ä¸ƒç‰›äº‘ SDK (qiniu v7.14.0)
- âœ… åˆ›å»ºä¸ƒç‰›äº‘é…ç½®æ–‡ä»¶ (`backend/config/qiniu.js`)
  - Access Key: pq0cTJhSR4C6Y2BwDs64bYOnad0Wj8jQq-cSYlZu
  - Secret Key: CN-welV4NEXv6DpuGEqwbEls0CCpqYMRMnPQsiK9
  - Bucket: forum-images
  - Domain: http://t6qsnqnup.sabkt.gdipper.com
  - Zone: æ–°åŠ å¡ (Zone_as0)
- âœ… åˆ›å»ºä¸Šä¼ æ§åˆ¶å™¨ (`backend/controllers/uploadController.js`)
  - ç”Ÿæˆä¸ƒç‰›äº‘ä¸Šä¼ å‡­è¯ï¼ˆæœ‰æ•ˆæœŸ1å°æ—¶ï¼‰
- âœ… åˆ›å»ºä¸Šä¼ è·¯ç”± (`backend/routes/uploadRoutes.js`)
  - `GET /api/upload/token` - è·å–ä¸Šä¼ å‡­è¯ï¼ˆéœ€è¦ç™»å½•ï¼‰
- âœ… åœ¨ server.js ä¸­æ³¨å†Œä¸Šä¼ è·¯ç”±
- âœ… æ›´æ–°æ•°æ®æ¨¡å‹ï¼š
  - Post æ¨¡å‹æ·»åŠ  `images: [String]` å­—æ®µ
  - Comment æ¨¡å‹æ·»åŠ  `images: [String]` å­—æ®µ

### 2. å‰ç«¯å®ç°
- âœ… åˆ›å»ºå›¾ç‰‡ä¸Šä¼ ç»„ä»¶ (`frontend/components/ImageUpload.tsx`)
  - æ”¯æŒå¤šå›¾ç‰‡é€‰æ‹©å’Œä¸Šä¼ 
  - å®æ—¶é¢„è§ˆä¸Šä¼ çš„å›¾ç‰‡
  - å¯åˆ é™¤å·²ä¸Šä¼ çš„å›¾ç‰‡
  - æ˜¾ç¤ºä¸Šä¼ è¿›åº¦å’Œé”™è¯¯æç¤º
  - é™åˆ¶å›¾ç‰‡æ•°é‡å’Œå¤§å°ï¼ˆå•å¼ æœ€å¤§5MBï¼‰
- âœ… æ›´æ–° API å®¢æˆ·ç«¯ (`frontend/lib/apiClient.ts`)
  - æ·»åŠ  `upload.getToken()` æ–¹æ³•
  - æ›´æ–° `posts.create()` æ”¯æŒ images å‚æ•°
  - æ›´æ–° `comments.add()` æ”¯æŒ images å‚æ•°
- âœ… æ›´æ–°å‘å¸–é¡µé¢ (`frontend/app/posts/create/page.tsx`)
  - é›†æˆ ImageUpload ç»„ä»¶
  - æ”¯æŒä¸Šä¼ æœ€å¤š 9 å¼ å›¾ç‰‡
- âœ… æ›´æ–°å¸–å­è¯¦æƒ…é¡µ (`frontend/app/posts/[id]/page.tsx`)
  - æ˜¾ç¤ºå¸–å­ä¸­çš„å›¾ç‰‡ï¼ˆç½‘æ ¼å¸ƒå±€ï¼Œ200x200pxï¼‰
  - è¯„è®ºåŒºæ·»åŠ å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼ˆæœ€å¤š 6 å¼ ï¼‰
  - æ˜¾ç¤ºè¯„è®ºä¸­çš„å›¾ç‰‡ï¼ˆç½‘æ ¼å¸ƒå±€ï¼Œ120x120pxï¼‰
  - ç‚¹å‡»å›¾ç‰‡å¯åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€åŸå›¾
- âœ… æ›´æ–°å¸–å­åˆ—è¡¨é¡µ (`frontend/app/posts/page.tsx`)
  - æ˜¾ç¤ºå¸–å­ç¼©ç•¥å›¾ï¼ˆå‰3å¼ ï¼Œ150x150pxï¼‰
  - è¶…è¿‡3å¼ æ—¶æ˜¾ç¤º"+N"æ ‡è®°

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### ä¸Šä¼ é™åˆ¶
- å¸–å­ï¼šæœ€å¤š 9 å¼ å›¾ç‰‡
- è¯„è®ºï¼šæœ€å¤š 6 å¼ å›¾ç‰‡
- å•å¼ å›¾ç‰‡ï¼šæœ€å¤§ 5MB
- æ”¯æŒæ ¼å¼ï¼šæ‰€æœ‰å¸¸è§å›¾ç‰‡æ ¼å¼ï¼ˆjpg, png, gif, webpç­‰ï¼‰

### ç”¨æˆ·ä½“éªŒ
- âœ¨ å®æ—¶å›¾ç‰‡é¢„è§ˆ
- âœ¨ ä¸Šä¼ è¿›åº¦æç¤º
- âœ¨ é”™è¯¯ä¿¡æ¯æ˜¾ç¤º
- âœ¨ ç‚¹å‡»åˆ é™¤å·²ä¸Šä¼ å›¾ç‰‡
- âœ¨ å›¾ç‰‡ç½‘æ ¼å¸ƒå±€å±•ç¤º
- âœ¨ ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹åŸå›¾

### å®‰å…¨æ€§
- ğŸ”’ éœ€è¦ç™»å½•æ‰èƒ½ä¸Šä¼ å›¾ç‰‡
- ğŸ”’ JWT token éªŒè¯
- ğŸ”’ æ–‡ä»¶å¤§å°é™åˆ¶
- ğŸ”’ æ–‡ä»¶ç±»å‹éªŒè¯

## ğŸ“ ä½¿ç”¨æ–¹æ³•

### å‘å¸–æ—¶ä¸Šä¼ å›¾ç‰‡
1. ç™»å½•è´¦å·
2. è¿›å…¥"å‘å¸ƒå¸–å­"é¡µé¢
3. å¡«å†™æ ‡é¢˜å’Œå†…å®¹
4. ç‚¹å‡»"ğŸ“· é€‰æ‹©å›¾ç‰‡"æŒ‰é’®
5. é€‰æ‹©å›¾ç‰‡ï¼ˆå¯å¤šé€‰ï¼Œæœ€å¤š9å¼ ï¼‰
6. ç­‰å¾…ä¸Šä¼ å®Œæˆï¼ˆæ˜¾ç¤ºé¢„è§ˆï¼‰
7. ç‚¹å‡»"å‘å¸ƒ"æŒ‰é’®

### è¯„è®ºæ—¶ä¸Šä¼ å›¾ç‰‡
1. è¿›å…¥å¸–å­è¯¦æƒ…é¡µ
2. åœ¨è¯„è®ºæ¡†å¡«å†™å†…å®¹
3. åœ¨"æ·»åŠ å›¾ç‰‡"åŒºåŸŸç‚¹å‡»"ğŸ“· é€‰æ‹©å›¾ç‰‡"
4. é€‰æ‹©å›¾ç‰‡ï¼ˆå¯å¤šé€‰ï¼Œæœ€å¤š6å¼ ï¼‰
5. ç­‰å¾…ä¸Šä¼ å®Œæˆ
6. ç‚¹å‡»"å‘è¡¨è¯„è®º"

## ğŸš€ æœ¬åœ°æµ‹è¯•

### å¯åŠ¨åç«¯ï¼ˆç«¯å£ 5000ï¼‰
```bash
cd backend
node server.js
```
è¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š
```
ğŸš€ åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ 5000
ğŸ“ API åŸºç¡€ URL: http://localhost:5000/api
âœ… MongoDB è¿æ¥æˆåŠŸ
```

### å¯åŠ¨å‰ç«¯ï¼ˆç«¯å£ 3000ï¼‰
```bash
cd frontend
npm run dev
```
è¾“å‡ºåº”è¯¥æ˜¾ç¤ºï¼š
```
â–² Next.js 15.5.6
- Local:        http://localhost:3000
âœ“ Starting...
```

### è®¿é—®ç½‘ç«™
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:3000

## ğŸ“‹ API æ–‡æ¡£

### è·å–ä¸Šä¼ å‡­è¯
```http
GET /api/upload/token
Authorization: Bearer <jwt_token>

Response:
{
  "success": true,
  "token": "ä¸ƒç‰›äº‘ä¸Šä¼ å‡­è¯",
  "domain": "http://t6qsnqnup.sabkt.gdipper.com"
}
```

### åˆ›å»ºå¸¦å›¾ç‰‡çš„å¸–å­
```http
POST /api/posts
Authorization: Bearer <jwt_token>
Content-Type: application/json

{
  "title": "å¸–å­æ ‡é¢˜",
  "content": "å¸–å­å†…å®¹",
  "images": [
    "http://t6qsnqnup.sabkt.gdipper.com/forum/xxx.jpg",
    "http://t6qsnqnup.sabkt.gdipper.com/forum/yyy.png"
  ]
}
```

### åˆ›å»ºå¸¦å›¾ç‰‡çš„è¯„è®º
```http
POST /api/posts/:postId/comments
Authorization: Bearer <jwt_token>
Content-Type: application/json

{
  "content": "è¯„è®ºå†…å®¹",
  "images": [
    "http://t6qsnqnup.sabkt.gdipper.com/forum/zzz.jpg"
  ]
}
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### Post é›†åˆ
```javascript
{
  _id: ObjectId,
  title: String,
  content: String,
  images: [String],  // å›¾ç‰‡URLæ•°ç»„
  author: ObjectId,
  likes: [ObjectId],
  views: Number,
  comments: [ObjectId],
  createdAt: Date,
  updatedAt: Date
}
```

### Comment é›†åˆ
```javascript
{
  _id: ObjectId,
  content: String,
  images: [String],  // å›¾ç‰‡URLæ•°ç»„
  author: ObjectId,
  post: ObjectId,
  likes: [ObjectId],
  createdAt: Date,
  updatedAt: Date
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸ƒç‰›äº‘é…ç½®**
   - å·²é…ç½®çš„ bucket åç§°éœ€è¦ä¸ä¸ƒç‰›äº‘æ§åˆ¶å°ä¸­çš„å®é™…åç§°ä¸€è‡´
   - Access Key å’Œ Secret Key è¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æ³„éœ²

2. **å­˜å‚¨ç©ºé—´**
   - å½“å‰ä½¿ç”¨æ–°åŠ å¡èŠ‚ç‚¹ (Zone_as0)
   - å›¾ç‰‡ URL æ ¼å¼ï¼š`http://domain/forum/timestamp_random.ext`

3. **åˆ é™¤é—®é¢˜**
   - åˆ é™¤å¸–å­æˆ–è¯„è®ºæ—¶ï¼Œå›¾ç‰‡ä¸ä¼šè‡ªåŠ¨ä»ä¸ƒç‰›äº‘åˆ é™¤
   - éœ€è¦å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„å›¾ç‰‡ï¼ˆå¯åæœŸæ·»åŠ å®šæ—¶ä»»åŠ¡ï¼‰

4. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**
   - å»ºè®®é…ç½® CDN åŠ é€Ÿ
   - å¯ä»¥æ·»åŠ å›¾ç‰‡å‹ç¼©åŠŸèƒ½
   - å¯ä»¥æ·»åŠ å›¾ç‰‡æ°´å°åŠŸèƒ½

## ğŸ”„ ä¸‹ä¸€æ­¥ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

- [ ] æ·»åŠ å›¾ç‰‡å‹ç¼©åŠŸèƒ½ï¼ˆå®¢æˆ·ç«¯å‹ç¼©ï¼‰
- [ ] æ·»åŠ å›¾ç‰‡è£å‰ªåŠŸèƒ½
- [ ] æ·»åŠ å›¾ç‰‡æ°´å°
- [ ] æ”¯æŒæ‹–æ‹½ä¸Šä¼ 
- [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦æ¡
- [ ] å®ç°å›¾ç‰‡æ‡’åŠ è½½
- [ ] æ·»åŠ å›¾ç‰‡ç¼“å­˜æœºåˆ¶
- [ ] å®ç°å›¾ç‰‡åˆ é™¤æ—¶åŒæ­¥åˆ é™¤ä¸ƒç‰›äº‘æ–‡ä»¶

## âœ… æµ‹è¯•æ¸…å•

- [x] åç«¯æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [x] å‰ç«¯æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å‘å¸–ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½
- [ ] è¯„è®ºä¸Šä¼ å›¾ç‰‡åŠŸèƒ½
- [ ] å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- [ ] å›¾ç‰‡åˆ é™¤åŠŸèƒ½
- [ ] å¸–å­åˆ—è¡¨æ˜¾ç¤ºç¼©ç•¥å›¾
- [ ] å¸–å­è¯¦æƒ…æ˜¾ç¤ºå®Œæ•´å›¾ç‰‡
- [ ] è¯„è®ºåŒºæ˜¾ç¤ºå›¾ç‰‡
- [ ] ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹åŸå›¾

---

**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œç­‰å¾…æœ¬åœ°æµ‹è¯•
**æ—¶é—´**: 2025å¹´12æœˆ4æ—¥
**ç‰ˆæœ¬**: v1.0
